<div id="comments" class="card comment">
	<div class="card-body">
		<div class="comment-user">
			<h5 class="card-title comment-user-avatar">
				<%= image_tag comment.user.avatar, class: "avatar" if comment.user.avatar.attached? %>
			</h5>
			<div class="card-title comment-user-name">
				<%= comment.user.name %>
			</div>
		</div>
		<div class="comment-status">
			<p class="card-text comment-user-status">
				<%= comment.status_i18n %>
			</p>
			<div id="star-rate-<%= comment.id %>" class="comment-user-rate">
			</div>
		</div>

		<div class="comment-user-comment">
			<p class="card-text">
				<%= auto_link(simple_format(h(comment.comment), {}, sanitize: false, wrapper_tag: "div")) %>
			</p>
		</div>
		<p class="card-text comment-user-created_at"><small class="text-muted"><%= comment.created_at.strftime("%Y/%-m/%-d %-H:%-M ") %></small>
		</p>
		<%= link_to "", shop_comment_path(@shop.id, comment.id), method: :delete, data: { confirm: "コメント「#{comment.comment}」を削除します。よろしいですか？" }, class: "delete-icon" %>

		<hr>

		<div id="like-icon-comment-<%= comment.id.to_s %>">
			<% if user_signed_in? && comment.liked_by(current_user).present? %>
			<%= link_to 'いいねを取り消す', shop_comment_like_path(@shop.id, comment.id, comment.liked_by(current_user)), method: :delete, remote: true, class: "loved hide-text" %>
			<% else %>
			<%= link_to 'いいね', shop_comment_likes_path(@shop.id, comment.id), method: :post, remote: true, class: "love hide-text" %>
			<% end %>
		</div>
		<div id="like-text-comment-<%= comment.id.to_s %>">
			<%= render "comments/like_text", { likes: comment.likes } %>
		</div>
	</div>
	<% if comment.user == current_user %>
		<%= link_to '', shop_comment_path(@shop, comment.id), method: :delete, data: { confirm: "コメントを削除します。よろしいですか？" }, class: "delete-btn" %>
	<% end %>
</div>

<script>
	$('#star-rate-<%= comment.id %>').raty({
		size: 36,
		starOff: '<%= asset_path('/star_off.png') %>',
		starOn: '<%= asset_path('/star_on.png') %>',
		starHalf: '<%= asset_path('/star_half.png') %>',
		score: '<%= comment.rate %>',
		half: true,
		readOnly: true
	});
</script>
