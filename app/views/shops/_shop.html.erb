<div class="card border-light shop">
	<%= link_to shop_path(shop.id) do %>
	<% if shop.images.attached? %>
		<div class="shop-image">
			<%= image_tag url_for(shop.images[0]), class: 'card-img-top shop-image' %>
			<div id="favorite-shop-<%= shop.id.to_s %>">
				<% if user_signed_in? %>
					<% if !Favorite.exists?(user_id: current_user.id, shop_id: shop.id) %>
						<%= link_to '', shop_favorite_path(shop), method: :post, remote: true, class: "unfavorite" %>
					<% else %>
						<%= link_to '', shop_favorite_path(shop), method: :delete, remote: true, class: "favorite" %>
					<% end %>
				<% else %>
					<div class="unfavorite"></div>
				<% end %>
			</div>
		</div>
	<% else %>
		<%= image_tag '/no-image.png', class: 'card-img-top shop-image' %>
	<% end %>
	<div class="card-body shops-description">
		<h5 class="card-title font-weight-bold"><%= shop.name.truncate(20, omission: '...') %></h5>
		<div>
			<p class="shop-status"><i class="far fa-dizzy" data-toggle="tooltip" data-placement="top"
					title="<%= :混んでいた %>"></i>&nbsp<%= shop.number_of_people_saying_crowded(shop) %>人</p>
			<p class="shop-status"><i class="far fa-smile" data-toggle="tooltip" data-placement="top"
					title="普通だった"></i>&nbsp<%= shop.number_of_people_saying_usually(shop) %>人</p>
			<p class="shop-status"><i class="far fa-laugh" data-toggle="tooltip" data-placement="top"
					title="空いていた"></i>&nbsp<%= shop.number_of_people_saying_vacant(shop) %>人</p>
		</div>
		<div>
			<p class="star-rate" id="star-rate-<%= shop.id %>"></p>&nbsp<%= shop.rate_average %>
			<i class="far fa-comments"></i>&nbsp<%= shop.comments.size %>件
		</div>
		<% if current_user&.admin? %>
			<%= link_to '', shop_path(shop.id), method: :delete, data: { confirm: "「#{shop.name}」を削除します。よろしいですか？" }, class: "delete-btn" %>
		<% end %>
	</div>
	<% end %>
</div>

<script>
	$("img.lazy").lazyload();
	$('[data-toggle="tooltip"]').tooltip();
	$('#star-rate-<%= shop.id %>').raty({
		size: 36,
		starOff: '<%= asset_path('/star_off.png') %>',
		starOn: '<%= asset_path('/star_on.png') %>',
		starHalf: '<%= asset_path('/star_half.png') %>',
		score: '<%= shop.comments.average(:rate) %>',
		half: true,
		readOnly: true
	});
</script>
