<div class="card border-light shop">
	<%= link_to shop_path(shop.id) do %>
	<% if shop.images.attached? %>
		<div class="shop-image">
			<%= lazysizes_image_tag url_for(shop.images[0]), class: 'card-img-top shop-image' %>
		</div>
	<% else %>
		<%= lazysizes_image_tag '/no-image.png', class: 'card-img-top shop-image' %>
	<% end %>
	<div class="card-body shops-description">
		<!--混雑状況-->
		<%= render partial: 'congestions/partial', locals: { shop: shop} %>
		<!--お気に入り-->
		<%= render partial: 'favorites/partial', locals: { shop: shop} %>
		<h5 class="card-title font-weight-bold"><%= shop.name.truncate(20, omission: '...') %></h5>
		<div>
			<p class="star-rate" id="star-rate-<%= shop.id %>"></p>&nbsp<%= shop.rate_average %>
			<i class="far fa-comments"></i>&nbsp<%= shop.comments.size %>件
		</div>
		<% if current_user&.admin? %>
			<%= link_to '', shop_path(shop.id), method: :delete, data: { confirm: "「#{shop.name}」を削除します。よろしいですか？" }, class: "delete-btn" %>
		<% end %>
	</div>
	<% end %>
</div>

<script>
	$('[data-toggle="tooltip"]').tooltip();
	$('#star-rate-<%= shop.id %>').raty({
		size: 36,
		starOff: '<%= asset_path('/star_off.png') %>',
		starOn: '<%= asset_path('/star_on.png') %>',
		starHalf: '<%= asset_path('/star_half.png') %>',
		score: '<%= shop.comments.average(:rate) %>',
		half: true,
		readOnly: true
	});
</script>
